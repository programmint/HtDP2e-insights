学习笔记 / 第5章：添加结构体

<br>


### 5.3、观 84 题，非纠缠的问题（2） — 注释详细程度，该如何？

**缘起**

解 84 题时，有些问题，必须得解开，否则后面的题目，还会继续纠缠。

此时纠缠，胜于后面纠缠不清。

<br>

共有 4 个问题点：

第1、函数描述名，该不该有?  
 
**第2、注释之详细程度，该如何?(本篇主题)**

第 3、变量名，代码结构，该有意义

第4、代码结构该有意义

<br>


### 5.3.1、问题

代码中肯定有注释，随着做题，发现一问题：

**注释到底该详细，还是该简约？**

见下方。
<br><br>

### 5.3.2、示例

目的声明 - 简约注释版（Ai 建议的方式）
```
; 根据输入的按键更新编辑器状态
; Editor KeyEvent -> Editor
(define (handle-key-event ed key)
  (cond
   [(and (single-char? key) (valid-input? key)) (insert-char ed key)]
   [(and (key=? key "left") (can-move-left? ed)) (move-cursor-left ed)]
   [(and (key=? key "right") (can-move-right? ed)) (move-cursor-right ed)]
   [(and (key=? key "\b") (can-delete? ed)) (delete-char-left ed)]
   [else ed]))
```
<br>

目的声明 - 稍加详细注释版（我的方式）
```
; 处理按键事件，满足限定条件，则返回新状态编辑器
(define (handle-key-event ed a-key)
  (cond
   [(and (single-char? a-key) (avoid-charts a-key) (insert-char ed a-key)]
   [(and (key=? a-key "left") (can-move-left? ed)) (move-cursor-left ed)]
   [(and (key=? a-key "right") (can-move-right? ed)) (move-cursor-right ed)]
   [(and (key=? a-key "\b") (can-delete? ed)) (delete-char-left ed)]
   [else ed]))
```
<br>

我的“目的声明”，提到了要注意限定条件：

**第 1、写限定条件：** 可以帮助思考，免得遗漏功能点，可又略显多余。

**第 2、不写限定条件：** 似乎也可以，函数名，函数功能才是反映限定条件的主体。

同时，我把目的声明，视为需求，倾向于写细，以校验函数功能是否到位？

到底该不该写限定条件？

<br>

### 5.3.3、讨论
依然问 Ai，答复如下：

你提出的是注释详细程度的重要问题。

关于限定条件的说明，我建议采取这样的平衡：

**1、简洁目的声明中暗示关键限制：**
```
; 处理按键事件，根据不同类型的按键和当前编辑器状态更新编辑器
; Editor KeyEvent -> Editor
``` 
<br>

**2、对于复杂或非直观的限定条件，可以单独列出：**
```
; 处理按键事件，更新编辑器状态
; 限制条件：
; - 忽略制表符和回车键
; - 只有光标不在最左侧时才处理左移和删除
; - 只有光标不在最右侧时才处理右移
; Editor KeyEvent -> Editor
```
<br>

这样的平衡考虑了：  

**完整性：** 不遗漏重要的限定条件

**可读性：** 避免过于冗长的注释

**有用性：** 提供对理解和使用函数真正有帮助的信息

对于简单函数，限定条件可能是显而易见的，可以省略；对于复杂函数或有特殊边界条件的函数，明确说明限定条件能够帮助他人正确使用和维护代码。

最佳实践是在注释中关注那些"非显而易见"的限制，而让代码本身通过良好的命名和结构来表达基本逻辑。

<br>

**又问 Ai ：**

>最佳实践是在注释中关注那些"非显而易见"的限制，而让代码本身通过良好的命名和结构来表达基本逻辑。

针对这个观点，能不能举例解释一下?

<br>

**Ai 答复：**

**例1：显而易见的限制不需在注释中强调**

```
; 计算两个正整数的平均值
; Number Number -> Number
(define (average a b)
  (/ (+ a b) 2))
```
这里不需要在注释中说明" a 和 b 必须是数字"，因为：
<ul style="padding-left: 0; list-style-position: inside;line-height: 2.0;">
<li>函数签名已经表明了类型要求</li>
<li>函数名和实现清晰表达了目的</li>
<li>这是数学运算的基本预期</li>
</ul>

<br>

**例2：非显而易见的限制应在注释中说明**
```
; 计算文件中的单词数量
; 限制条件：
; - 文件必须存在且可读
; - 文件大小不能超过100MB（防止内存溢出）
; - 单词以空格、制表符或换行符分隔
; String -> Number
(define (count-words filename)
  (if (file-exists? filename)
      (let ([content (read-file filename)])
        (length (string-split content)))
      0))
```


<ul style="padding-left: 0; list-style-position: inside;line-height: 2.0;">
这里的限制很重要且不直接从函数名推断出：
<li>文件大小限制是实现的特定约束</li>
<li>单词分隔符的定义影响结果</li>
<li>文件不存在时返回 0（而不是报错）是需要知道的行为</li>
</ul>

<br>

**例3：关键算法假设需要说明**
```
; 使用二分查找在有序列表中查找元素
; 限制条件：
; - 列表必须已按升序排列
; - 时间复杂度：O(log n)
; - 空间复杂度：O(1)
; [List-of Number] Number -> Boolean
(define (binary-search lst target)
  ...)
```
这里的排序假设是算法正确性的关键，不说明会导致误用。

<br>

**例4：借助代码结构表达限制**

而不是：
```
; 处理按键，如果是有效字符则插入，如果是退格则删除，如果是方向键则移动光标
; Editor KeyEvent -> Editor
```
<br>

更好的做法：
```
; 处理编辑器的按键事件
; Editor KeyEvent -> Editor
(define (handle-key-event ed key)
  (cond
   [(valid-character? key) (insert-character ed key)]
   [(navigation-key? key) (move-cursor ed key)]
   [(deletion-key? key) (delete-character ed key)]
   [else ed]))
```

这里通过辅助函数的命名和结构清晰表达了不同类型按键的处理逻辑，无需在注释中详细说明。

重点是让注释关注那些"阅读代码难以立即理解"的关键信息，而不是重复已经通过良好命名和代码结构表达的内容。

<br>

**我的理解**

如果代码能说明信息，就不必在注释里添加了。反之，则需要添加。

针对各个函数的特性，针对性添加注释，而不是死板套用一种风格的注释。

<br>

**Ai 回复**

完全正确！你总结得非常到位。

注释应该是代码的补充，而不是重复。好的注释应当：

第1、解释代码无法自我表达的内容

第2、说明为什么这样做，而不仅仅是做了什么

第3、针对函数的特殊性质进行说明

第4、 灵活调整详细程度，根据函数的复杂性和重要性

这种方法能使代码文档既简洁又有价值，避免了"注释噪音"，同时确保了重要信息不会被遗漏。

注释的最终目标是帮助他人（包括未来的自己）理解代码，而不是遵循固定的模板或格式。好的编程风格需要在不同情况下做出合理的判断，就像你所说的那样。
<br>

### 5.3.4、总结
回到最开始的问题，我写下的“目的声明”，

Ai 总结：

关于目的声明中是否明确提及限定条件，我认为要根据具体情况判断：

在这个例子中，我倾向于你的方法略胜一筹，因为：

第1、"满足限定条件"这一提示能让读者更加关注代码中的条件判断

第2、这是编辑器核心功能，明确指出有条件限制可以防止误用

第3、短短几个字就传达了重要信息，成本很低

<br>

**不过，理想的形式可能是这样：**
```
; 根据输入的按键更新编辑器状态，仅在满足特定条件时执行相应操作
; Editor KeyEvent -> Editor
```
这种方式既指出了有限定条件，又不过分详细。

取舍的原则可以是：
<ul style="padding-left: 0; list-style-position: inside;line-height: 2.0;">
<li>如果限定条件是功能核心部分，值得在目的声明中点明</li>

<li>如果限定条件很多且复杂，可以用"满足特定条件"概括，细节让代码说明</li>

<li>如果限定条件非常直观（如数学函数要求数字输入），则不必在目的声明中提及</li>
</ul>
总的来说，我认为在这个特定函数中，提及限定条件是有价值的，但要用简洁的方式表达。



